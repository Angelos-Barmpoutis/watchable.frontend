<ng-container *ngIf="!isLoading; else loadingTemplate">
    <div appFadeIn class="media-hero" appBackgroundPath [backgroundPath]="mediaDetails?.backdrop_path ?? ''">
        <div class="overlay">
            <div class="wrapper">
                <div class="media-content">
                    <div class="media-poster">
                        <div *ngIf="isInWatchlist" class="bookmark-ribbon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                        <img
                            *ngIf="mediaDetails?.poster_path"
                            appPosterPath
                            [posterPath]="mediaDetails?.poster_path ?? ''"
                            [size]="posterSize.w342"
                        />
                        <img *ngIf="!mediaDetails?.poster_path" [src]="default.largePosterFallback" />
                    </div>
                    <div class="media-info">
                        <div *ngIf="isInWatchlist" class="watchlist-badge">
                            <i class="fas fa-bookmark"></i>
                            <span>In Watchlist</span>
                        </div>
                        <h1 class="media-title">
                            {{ title }}
                            <span *ngIf="subtitle" class="media-subtitle">({{ subtitle }})</span>
                        </h1>
                        <div class="media-meta">
                            <div *ngIf="releaseDate" class="media-year">
                                {{ releaseDate | date: "yyyy" }}
                                <span
                                    *ngIf="
                                        type === mediaType.TvShow &&
                                        (endDate | date: 'yyyy') !== (releaseDate | date: 'yyyy')
                                    "
                                    class="media-year"
                                >
                                    - {{ endDate | date: "yyyy" }}
                                </span>
                            </div>
                            <span *ngIf="runtime" class="runtime">
                                {{ runtime | time }}
                            </span>
                        </div>

                        <div class="overview">
                            <p>{{ mediaDetails?.overview }}</p>
                        </div>

                        <div class="action-buttons">
                            <app-button
                                *ngIf="trailerVideo"
                                [variant]="ButtonType.Primary"
                                [type]="'button'"
                                [icon]="'fas fa-play'"
                                [text]="'Watch Trailer'"
                                [title]="'Watch Trailer'"
                                (click)="toggleTrailer()"
                            >
                            </app-button>
                            <app-button
                                [variant]="ButtonType.Secondary"
                                [type]="'button'"
                                [icon]="isInWatchlist ? 'fas fa-bookmark' : 'far fa-bookmark'"
                                [text]="isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"
                                [title]="isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"
                                (click)="toggleWatchlist()"
                            >
                            </app-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-video-gallery
        [videos]="trailerVideo ? [trailerVideo] : []"
        [selectedIndex]="showTrailer ? 0 : undefined"
        [showPreviewStrip]="false"
        (closeViewer)="toggleTrailer()"
    ></app-video-gallery>
</ng-container>

<ng-template #loadingTemplate>
    <div class="wrapper">
        <div class="skeleton-media-hero">
            <div class="skeleton-media-content">
                <div class="skeleton-media-poster"></div>
                <div class="skeleton-media-info">
                    <div class="skeleton-media-title"></div>
                    <div class="skeleton-media-meta">
                        <div class="skeleton-media-meta-item"></div>
                        <div class="skeleton-media-meta-item"></div>
                    </div>
                    <div class="skeleton-media-overview">
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                    </div>
                    <div class="skeleton-media-buttons">
                        <app-button
                            [variant]="ButtonType.Primary"
                            [type]="'button'"
                            [icon]="'fas fa-play'"
                            [text]="'Watch Trailer'"
                            [isLoading]="true"
                        ></app-button>
                        <app-button
                            [variant]="ButtonType.Secondary"
                            [type]="'button'"
                            [icon]="isInWatchlist ? 'fas fa-bookmark' : 'far fa-bookmark'"
                            [text]="isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"
                            [title]="isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"
                            [isLoading]="true"
                        >
                        </app-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
