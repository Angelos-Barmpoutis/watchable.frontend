<ng-container *ngIf="!isLoading; else loadingTemplate">
    <div appFadeIn class="media-hero" [style.background-image]="backdropUrl">
        <div class="overlay">
            <div class="wrapper">
                <div class="media-content">
                    <div class="media-poster">
                        <img
                            *ngIf="mediaDetails?.poster_path"
                            appPosterPath
                            [posterPath]="mediaDetails?.poster_path ?? ''"
                            [size]="posterSize.w342"
                        />
                        <img *ngIf="!mediaDetails?.poster_path" [src]="default.largePosterFallback" />
                    </div>
                    <div class="media-info">
                        <h2 class="media-title">
                            {{ title }}
                        </h2>
                        <div class="media-meta">
                            <span *ngIf="releaseDate" class="media-year">
                                {{ releaseDate | date: "yyyy" }}
                            </span>
                            <span *ngIf="runtime" class="runtime">
                                {{ runtime | time }}
                            </span>
                            <span *ngIf="mediaDetails?.genres?.length" class="genres">
                                <span *ngFor="let genre of mediaDetails?.genres; let last = last">
                                    {{ genre?.name }}{{ !last ? ", " : "" }}
                                </span>
                            </span>
                        </div>

                        <div *ngIf="voteAverage !== 0" class="rating-container">
                            <div class="rating">
                                <div class="rating-badge">
                                    <span
                                        class="rating-value"
                                        [class.rating-low]="voteAverage < 5"
                                        [class.rating-medium]="voteAverage >= 5 && voteAverage < 7"
                                        [class.rating-high]="voteAverage >= 7 && voteAverage < 8.5"
                                        [class.rating-top]="voteAverage >= 8.5"
                                    >
                                        {{ voteAverage | number: "1.1-1" }}
                                    </span>
                                    <span class="rating-total">/10</span>
                                </div>
                                <div class="rating-details">
                                    <span class="vote-count">{{ voteCount }} votes</span>
                                </div>
                            </div>
                            <app-button
                                [type]="ButtonType.Secondary"
                                [icon]="'fas fa-star'"
                                [text]="'Rate'"
                                [hasPadding]="false"
                            ></app-button>
                        </div>

                        <div class="overview">
                            <p>{{ mediaDetails?.overview }}</p>
                        </div>

                        <div class="action-buttons">
                            <app-button
                                *ngIf="trailerVideo"
                                [type]="ButtonType.Primary"
                                [icon]="'fas fa-play'"
                                [text]="'Watch Trailer'"
                                (click)="toggleTrailer()"
                            >
                            </app-button>
                            <app-button
                                [type]="ButtonType.Secondary"
                                [icon]="'fas fa-plus'"
                                [text]="'Add to Watchlist'"
                                [hasPadding]="false"
                            >
                            </app-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-video-gallery
        [videos]="trailerVideo ? [trailerVideo] : []"
        [selectedIndex]="showTrailer ? 0 : undefined"
        [showPreviewStrip]="false"
        (closeViewer)="toggleTrailer()"
    ></app-video-gallery>
</ng-container>

<ng-template #loadingTemplate>
    <div appFadeIn class="skeleton-media-hero">
        <div class="wrapper">
            <div class="skeleton-media-content">
                <div class="skeleton-media-poster"></div>
                <div class="skeleton-media-info">
                    <div class="skeleton-media-title"></div>
                    <div class="skeleton-media-meta">
                        <div class="skeleton-media-meta-item"></div>
                        <div class="skeleton-media-meta-item"></div>
                        <div class="skeleton-media-meta-item"></div>
                    </div>
                    <div class="skeleton-media-rating-container">
                        <div class="skeleton-media-rating"></div>
                        <div class="skeleton-media-rating-details"></div>
                        <app-button [type]="ButtonType.Secondary" [isLoading]="true" [hasPadding]="false"></app-button>
                    </div>
                    <div class="skeleton-media-overview">
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                    </div>
                    <div class="skeleton-media-buttons">
                        <app-button [type]="ButtonType.Primary" [isLoading]="true"></app-button>
                        <app-button [type]="ButtonType.Secondary" [isLoading]="true" [hasPadding]="false"></app-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
