<ng-container *ngIf="!isLoading; else loadingTemplate">
    <div appFadeIn class="media-hero" appBackgroundPath [backgroundPath]="mediaDetails?.backdrop_path ?? ''">
        <div class="overlay">
            <div class="wrapper">
                <div class="media-content">
                    <div class="media-poster">
                        <div *ngIf="isInWatchlist" class="bookmark-ribbon">
                            <i class="fas fa-bookmark"></i>
                        </div>
                        <img
                            *ngIf="mediaDetails?.poster_path"
                            appPosterPath
                            [posterPath]="mediaDetails?.poster_path ?? ''"
                            [size]="posterSize.w342"
                        />
                        <img *ngIf="!mediaDetails?.poster_path" [src]="default.largePosterFallback" />
                    </div>
                    <div class="media-info">
                        <h1 class="media-title">
                            {{ title }}
                            <span *ngIf="subtitle" class="media-subtitle">({{ subtitle }})</span>
                        </h1>
                        <div class="media-meta">
                            <span *ngIf="releaseDate" class="media-year">
                                {{ releaseDate | date: "yyyy" }}
                            </span>
                            <span *ngIf="runtime" class="runtime">
                                {{ runtime | time }}
                            </span>
                            <span *ngIf="mediaDetails?.genres?.length" class="genres">
                                <span *ngFor="let genre of mediaDetails?.genres; let last = last">
                                    {{ genre?.name }}{{ !last ? ", " : "" }}
                                </span>
                            </span>
                        </div>

                        <!-- <div class="rating-container">
                            <div class="rating">
                                <div class="rating-badge">
                                    <span
                                        *ngIf="voteAverage; else noRating"
                                        class="rating-value"
                                        [class.rating-low]="voteAverage < 5"
                                        [class.rating-medium]="voteAverage >= 5 && voteAverage < 7"
                                        [class.rating-high]="voteAverage >= 7 && voteAverage < 8.5"
                                        [class.rating-top]="voteAverage >= 8.5"
                                    >
                                        {{ voteAverage | number: "1.1-1" }}
                                    </span>
                                    <ng-template #noRating>
                                        <span class="rating-value">-</span>
                                    </ng-template>
                                    <span class="rating-total">/10</span>
                                </div>
                                <div *ngIf="voteCount" class="rating-details">
                                    <span class="vote-count">{{ voteCount | formatNumberWithK }} votes</span>
                                </div>
                            </div>
                            <div class="user-rating">
                                <div class="rating-stars">
                                    <button
                                        *ngFor="let star of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
                                        class="star-button"
                                        [class.active]="userRating === star"
                                        (click)="toggleRating(star)"
                                    >
                                        <i class="fas fa-star"></i>
                                    </button>
                                </div>
                                <span *ngIf="userRating" class="user-rating-value"
                                    >Your rating: {{ userRating }}/10</span
                                >
                            </div>
                        </div> -->

                        <div class="overview">
                            <p>{{ mediaDetails?.overview }}</p>
                        </div>

                        <div class="action-buttons">
                            <app-button
                                *ngIf="trailerVideo"
                                [variant]="ButtonType.Primary"
                                [type]="'button'"
                                [icon]="'fas fa-play'"
                                [text]="'Watch Trailer'"
                                (click)="toggleTrailer()"
                            >
                            </app-button>
                            <app-button
                                [variant]="ButtonType.Secondary"
                                [type]="'button'"
                                [icon]="isInWatchlist ? 'far fa-bookmark' : 'fas fa-bookmark'"
                                [text]="isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'"
                                [hasPadding]="false"
                                (click)="toggleWatchlist()"
                            >
                            </app-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-video-gallery
        [videos]="trailerVideo ? [trailerVideo] : []"
        [selectedIndex]="showTrailer ? 0 : undefined"
        [showPreviewStrip]="false"
        (closeViewer)="toggleTrailer()"
    ></app-video-gallery>
</ng-container>

<ng-template #loadingTemplate>
    <div class="wrapper">
        <div class="skeleton-media-hero">
            <div class="skeleton-media-content">
                <div class="skeleton-media-poster"></div>
                <div class="skeleton-media-info">
                    <div class="skeleton-media-title"></div>
                    <div class="skeleton-media-meta">
                        <div class="skeleton-media-meta-item"></div>
                        <div class="skeleton-media-meta-item"></div>
                        <div class="skeleton-media-meta-item"></div>
                    </div>
                    <!-- <div class="skeleton-media-rating-container">
                        <div class="skeleton-media-rating"></div>
                        <div class="skeleton-media-rating-details"></div>
                        <app-button
                            [variant]="ButtonType.Secondary"
                            [type]="'button'"
                            [icon]="'fas fa-star'"
                            [text]="'Rate'"
                            [isLoading]="true"
                            [hasPadding]="false"
                        ></app-button>
                    </div> -->
                    <div class="skeleton-media-overview">
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                        <div class="skeleton-media-overview-line"></div>
                    </div>
                    <div class="skeleton-media-buttons">
                        <app-button
                            [variant]="ButtonType.Primary"
                            [type]="'button'"
                            [icon]="'fas fa-play'"
                            [text]="'Watch Trailer'"
                            [isLoading]="true"
                        ></app-button>
                        <app-button
                            [variant]="ButtonType.Secondary"
                            [type]="'button'"
                            [icon]="'fas fa-plus'"
                            [text]="'Add to Watchlist'"
                            [isLoading]="true"
                            [hasPadding]="false"
                        ></app-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
